variables:
  DEBIAN_FRONTEND: noninteractive
  APT_GET_INSTALL: "apt-get install -q -y"

stages:
  - pre
  - build
  - test
  - deploy

pre-commit_alpine:
  stage: pre
  image:
    # https://hub.docker.com/_/alpine
    name: alpine:latest
  script:
    - date
    - cat /etc/os-release
    - apk add --no-cache bash gcc git musl-dev npm py3-pip python3-dev
    - pip install pre-commit
    # run pre-commit
    - pre-commit --version
    - pre-commit run --all-files

pycodestyle_alpine:
  stage: pre
  image:
    # https://hub.docker.com/_/alpine
    name: alpine:latest
  script:
    - date
    - cat /etc/os-release
    - apk add --no-cache py3-pycodestyle
    # check PEP 8 code style (pycodestyle was formerly called pep8)
    - pycodestyle --version
    - pycodestyle --show-source --show-pep8 --statistics $(find -name "*.py")

pylint_alpine:
  stage: pre
  image:
    # https://hub.docker.com/_/alpine
    name: alpine:latest
  script:
    - date
    - cat /etc/os-release
    - apk add --no-cache py3-pylint
    # run pylint
    - pylint --version
    - pylint --persistent n $(find -name "*.py")

pylint_debian:
  stage: pre
  image:
    # https://hub.docker.com/_/debian
    name: debian:latest
  script:
    - date
    - cat /etc/os-release
    - apt-get update
    - $APT_GET_INSTALL pylint
    # run pylint
    - pylint --version
    - pylint --persistent n $(find -name "*.py")

test_debian:
  stage: test
  image:
    # https://hub.docker.com/_/debian
    name: debian:latest
  script:
    - date
    - cat /etc/os-release
    - apt-get update
    - $APT_GET_INSTALL git python3
    # run tests
    - ./test/test1
    - ./test/test2
    - ./test/test3
    - rm -rf ~/git-data
    - ln -s $(pwd)/example_config.cfg ~/.file_hook_server_timestamping.cfg
    - ./test/test1
    - ./test/test2
    - ./test/test3
    - cat /tmp/file_hook_server_timestamping.log
